<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Building and operate a donkeycar | RoboCar project documentation</title>
  <meta name="description" content="Notes taken by Uwe for the RoboCar project" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Building and operate a donkeycar | RoboCar project documentation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notes taken by Uwe for the RoboCar project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Building and operate a donkeycar | RoboCar project documentation" />
  
  <meta name="twitter:description" content="Notes taken by Uwe for the RoboCar project" />
  

<meta name="author" content="Uwe Sterr" />


<meta name="date" content="2019-11-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="Conncectivity.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RoboCar project documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Project RoboCar</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#how-to-join-us"><i class="fa fa-check"></i><b>1.1</b> How to join us</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#faq"><i class="fa fa-check"></i><b>1.2</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="donkeyCar.html"><a href="donkeyCar.html"><i class="fa fa-check"></i><b>2</b> Building and operate a donkeycar</a><ul>
<li class="chapter" data-level="2.1" data-path="donkeyCar.html"><a href="donkeyCar.html#reason-for-changing-the-plattform"><i class="fa fa-check"></i><b>2.1</b> Reason for changing the plattform</a><ul>
<li class="chapter" data-level="2.1.1" data-path="donkeyCar.html"><a href="donkeyCar.html#carSelection"><i class="fa fa-check"></i><b>2.1.1</b> Selecting a RC car</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="donkeyCar.html"><a href="donkeyCar.html#what-to-do"><i class="fa fa-check"></i><b>2.2</b> What to do</a></li>
<li class="chapter" data-level="2.3" data-path="donkeyCar.html"><a href="donkeyCar.html#carWiring"><i class="fa fa-check"></i><b>2.3</b> Rewiring the car</a><ul>
<li class="chapter" data-level="2.3.1" data-path="donkeyCar.html"><a href="donkeyCar.html#parts-list"><i class="fa fa-check"></i><b>2.3.1</b> Parts list</a></li>
<li class="chapter" data-level="2.3.2" data-path="donkeyCar.html"><a href="donkeyCar.html#why-not-using-pca9685"><i class="fa fa-check"></i><b>2.3.2</b> Why not using PCA9685</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="donkeyCar.html"><a href="donkeyCar.html#folders-created-during-installation-of-host-pc"><i class="fa fa-check"></i><b>2.4</b> Folders created during installation of host PC</a></li>
<li class="chapter" data-level="2.5" data-path="donkeyCar.html"><a href="donkeyCar.html#calibrate-the-car"><i class="fa fa-check"></i><b>2.5</b> Calibrate the car</a><ul>
<li class="chapter" data-level="2.5.1" data-path="donkeyCar.html"><a href="donkeyCar.html#setting-wifi-up-for-the-raspberry"><i class="fa fa-check"></i><b>2.5.1</b> Setting WIFI up for the raspberry</a></li>
<li class="chapter" data-level="2.5.2" data-path="donkeyCar.html"><a href="donkeyCar.html#steering-calibration"><i class="fa fa-check"></i><b>2.5.2</b> Steering Calibration</a></li>
<li class="chapter" data-level="2.5.3" data-path="donkeyCar.html"><a href="donkeyCar.html#throttle-calibration"><i class="fa fa-check"></i><b>2.5.3</b> Throttle Calibration</a></li>
<li class="chapter" data-level="2.5.4" data-path="donkeyCar.html"><a href="donkeyCar.html#configpyAfterCalib"><i class="fa fa-check"></i><b>2.5.4</b> Config.py after calibration</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="donkeyCar.html"><a href="donkeyCar.html#drive-your-car-with-web-interface"><i class="fa fa-check"></i><b>2.6</b> Drive your car with web interface</a><ul>
<li class="chapter" data-level="2.6.1" data-path="donkeyCar.html"><a href="donkeyCar.html#preparation-on-mac"><i class="fa fa-check"></i><b>2.6.1</b> Preparation on Mac</a></li>
<li class="chapter" data-level="2.6.2" data-path="donkeyCar.html"><a href="donkeyCar.html#preparation-on-raspberry"><i class="fa fa-check"></i><b>2.6.2</b> Preparation on Raspberry</a></li>
<li class="chapter" data-level="2.6.3" data-path="donkeyCar.html"><a href="donkeyCar.html#open-control-in-web-browser-on-mac"><i class="fa fa-check"></i><b>2.6.3</b> Open control in web browser on Mac</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="donkeyCar.html"><a href="donkeyCar.html#connecting-bluetooth-controller"><i class="fa fa-check"></i><b>2.7</b> Connecting bluetooth controller</a><ul>
<li class="chapter" data-level="2.7.1" data-path="donkeyCar.html"><a href="donkeyCar.html#BluetoothControllerInstall"><i class="fa fa-check"></i><b>2.7.1</b> Connect your bluetooth controller to the raspberry pi.</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="donkeyCar.html"><a href="donkeyCar.html#start-driving-or-training"><i class="fa fa-check"></i><b>2.8</b> Start driving or training</a><ul>
<li class="chapter" data-level="2.8.1" data-path="donkeyCar.html"><a href="donkeyCar.html#create-movie-from-tub-data"><i class="fa fa-check"></i><b>2.8.1</b> Create movie from tub data</a></li>
<li class="chapter" data-level="2.8.2" data-path="donkeyCar.html"><a href="donkeyCar.html#options-of-manage.py"><i class="fa fa-check"></i><b>2.8.2</b> Options of manage.py</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="donkeyCar.html"><a href="donkeyCar.html#tips-on-how-to-drive-during-training"><i class="fa fa-check"></i><b>2.9</b> Tips on how to drive during training</a><ul>
<li class="chapter" data-level="2.9.1" data-path="donkeyCar.html"><a href="donkeyCar.html#how-to-edit-recorded-data"><i class="fa fa-check"></i><b>2.9.1</b> How to edit recorded data</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="donkeyCar.html"><a href="donkeyCar.html#mange-recorded-data"><i class="fa fa-check"></i><b>2.10</b> Mange recorded data</a><ul>
<li class="chapter" data-level="2.10.1" data-path="donkeyCar.html"><a href="donkeyCar.html#archiving-data"><i class="fa fa-check"></i><b>2.10.1</b> Archiving data</a></li>
<li class="chapter" data-level="2.10.2" data-path="donkeyCar.html"><a href="donkeyCar.html#delete-data"><i class="fa fa-check"></i><b>2.10.2</b> Delete data</a></li>
<li class="chapter" data-level="2.10.3" data-path="donkeyCar.html"><a href="donkeyCar.html#copy-files-from-raspi-to-mac"><i class="fa fa-check"></i><b>2.10.3</b> Copy files from raspi to mac</a></li>
<li class="chapter" data-level="2.10.4" data-path="donkeyCar.html"><a href="donkeyCar.html#how-big-is-the-tub-folder"><i class="fa fa-check"></i><b>2.10.4</b> How big is the tub folder</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="donkeyCar.html"><a href="donkeyCar.html#train-neural-network"><i class="fa fa-check"></i><b>2.11</b> Train neural network</a></li>
<li class="chapter" data-level="2.12" data-path="donkeyCar.html"><a href="donkeyCar.html#run-car-on-neural-net"><i class="fa fa-check"></i><b>2.12</b> Run car on neural net</a><ul>
<li class="chapter" data-level="2.12.1" data-path="donkeyCar.html"><a href="donkeyCar.html#change-model"><i class="fa fa-check"></i><b>2.12.1</b> change model</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="donkeyCar.html"><a href="donkeyCar.html#see-rainers-description"><i class="fa fa-check"></i><b>2.13</b> See Rainer’s description</a></li>
<li class="chapter" data-level="2.14" data-path="donkeyCar.html"><a href="donkeyCar.html#build-pre-processing-pipe-line"><i class="fa fa-check"></i><b>2.14</b> Build pre processing pipe line</a><ul>
<li class="chapter" data-level="2.14.1" data-path="donkeyCar.html"><a href="donkeyCar.html#install-opencv-on-the-raspi"><i class="fa fa-check"></i><b>2.14.1</b> Install openCV on the raspi</a></li>
</ul></li>
<li class="chapter" data-level="2.15" data-path="donkeyCar.html"><a href="donkeyCar.html#bluetooth-key-mapping"><i class="fa fa-check"></i><b>2.15</b> bluetooth key mapping</a></li>
<li class="chapter" data-level="2.16" data-path="donkeyCar.html"><a href="donkeyCar.html#load-h5-model-and-inspect"><i class="fa fa-check"></i><b>2.16</b> Load h5 model and inspect</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Conncectivity.html"><a href="Conncectivity.html"><i class="fa fa-check"></i><b>3</b> Wireless connections Raspi, Controller, Mac</a><ul>
<li class="chapter" data-level="3.1" data-path="Conncectivity.html"><a href="Conncectivity.html#purpose-of-connections"><i class="fa fa-check"></i><b>3.1</b> Purpose of connections</a></li>
<li class="chapter" data-level="3.2" data-path="Conncectivity.html"><a href="Conncectivity.html#setting-up-of-the-wireless-connections"><i class="fa fa-check"></i><b>3.2</b> Setting up of the wireless connections</a><ul>
<li class="chapter" data-level="3.2.1" data-path="Conncectivity.html"><a href="Conncectivity.html#bluetooth-connection"><i class="fa fa-check"></i><b>3.2.1</b> Bluetooth connection</a></li>
<li class="chapter" data-level="3.2.2" data-path="Conncectivity.html"><a href="Conncectivity.html#wifi-connection"><i class="fa fa-check"></i><b>3.2.2</b> Wifi connection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html"><i class="fa fa-check"></i><b>4</b> Donkey Command-line Utilities</a><ul>
<li class="chapter" data-level="4.1" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#create-car"><i class="fa fa-check"></i><b>4.1</b> Create Car</a></li>
<li class="chapter" data-level="4.2" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#find-car"><i class="fa fa-check"></i><b>4.2</b> Find Car</a></li>
<li class="chapter" data-level="4.3" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#calibrate-car"><i class="fa fa-check"></i><b>4.3</b> Calibrate Car</a></li>
<li class="chapter" data-level="4.4" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#clean-data-in-tub"><i class="fa fa-check"></i><b>4.4</b> Clean data in Tub</a></li>
<li class="chapter" data-level="4.5" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#make-movie-from-tub"><i class="fa fa-check"></i><b>4.5</b> Make Movie from Tub</a></li>
<li class="chapter" data-level="4.6" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#tubclean"><i class="fa fa-check"></i><b>4.6</b> Check Tub</a></li>
<li class="chapter" data-level="4.7" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#histogram"><i class="fa fa-check"></i><b>4.7</b> Histogram</a></li>
<li class="chapter" data-level="4.8" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#plot-predictions"><i class="fa fa-check"></i><b>4.8</b> Plot Predictions</a></li>
<li class="chapter" data-level="4.9" data-path="donkey-command-line-utilities.html"><a href="donkey-command-line-utilities.html#simulation-server"><i class="fa fa-check"></i><b>4.9</b> Simulation Server</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html"><i class="fa fa-check"></i><b>5</b> Donkeycar software analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#how-to-add-parts-to-a-vehicle"><i class="fa fa-check"></i><b>5.1</b> How to add parts to a vehicle</a><ul>
<li class="chapter" data-level="5.1.1" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#function-v.start"><i class="fa fa-check"></i><b>5.1.1</b> Function V.start()</a></li>
<li class="chapter" data-level="5.1.2" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#function-v.update_parts"><i class="fa fa-check"></i><b>5.1.2</b> Function V.update_parts()</a></li>
<li class="chapter" data-level="5.1.3" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#function-v.add"><i class="fa fa-check"></i><b>5.1.3</b> Function V.add</a></li>
<li class="chapter" data-level="5.1.4" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#threadedParts"><i class="fa fa-check"></i><b>5.1.4</b> Concept of threads vs non-threaded parts</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#structure-of-manage.py"><i class="fa fa-check"></i><b>5.2</b> Structure of <code>manage.py</code></a><ul>
<li class="chapter" data-level="5.2.1" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#creating-manage.py"><i class="fa fa-check"></i><b>5.2.1</b> Creating <code>manage.py</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#starting-manage.py"><i class="fa fa-check"></i><b>5.2.2</b> Starting <code>manage.py</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#parsing-the-command-line-parameters"><i class="fa fa-check"></i><b>5.2.3</b> Parsing the command line parameters</a></li>
<li class="chapter" data-level="5.2.4" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#function-drive"><i class="fa fa-check"></i><b>5.2.4</b> Function <code>drive</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#locate-modules-on-raspi-which-are-being-imported-by-manage.py"><i class="fa fa-check"></i><b>5.3</b> Locate modules on raspi which are being imported by manage.py</a></li>
<li class="chapter" data-level="5.4" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#AssignStickToAction"><i class="fa fa-check"></i><b>5.4</b> Assignment of WiiU controller sticks to action</a></li>
<li class="chapter" data-level="5.5" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#setMaxVel"><i class="fa fa-check"></i><b>5.5</b> Limit max velocity</a></li>
<li class="chapter" data-level="5.6" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#LedIndicatingRecordingMode"><i class="fa fa-check"></i><b>5.6</b> Add LED to indicate recording mode</a><ul>
<li class="chapter" data-level="5.6.1" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#wiring-of-led-to-pwmservo-hat"><i class="fa fa-check"></i><b>5.6.1</b> Wiring of LED to PWM/Servo HAT</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="donkeyCarSoftwareAnalysis.html"><a href="donkeyCarSoftwareAnalysis.html#change-default-recording-status-to-false"><i class="fa fa-check"></i><b>5.7</b> Change default recording status to false</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><i class="fa fa-check"></i><b>6</b> Installation of Tawn Kramers donkeycar version (By Rainer Bareiß)</a><ul>
<li class="chapter" data-level="6.1" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#environment"><i class="fa fa-check"></i><b>6.1</b> Environment</a></li>
<li class="chapter" data-level="6.2" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#sudo-raspi-config"><i class="fa fa-check"></i><b>6.2</b> sudo raspi-config</a></li>
<li class="chapter" data-level="6.3" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#etcwpa_supllicantwpa_supplicant.conf"><i class="fa fa-check"></i><b>6.3</b> etc/wpa_supllicant/wpa_supplicant.conf</a></li>
<li class="chapter" data-level="6.4" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#installs"><i class="fa fa-check"></i><b>6.4</b> installs</a></li>
<li class="chapter" data-level="6.5" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#install-donkey-on-pi"><i class="fa fa-check"></i><b>6.5</b> install donkey on pi</a></li>
<li class="chapter" data-level="6.6" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#config.piy"><i class="fa fa-check"></i><b>6.6</b> 5. config.piy</a></li>
<li class="chapter" data-level="6.7" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#bluetooth"><i class="fa fa-check"></i><b>6.7</b> bluetooth</a></li>
<li class="chapter" data-level="6.8" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#wii-u-controller"><i class="fa fa-check"></i><b>6.8</b> 8. wii u controller</a></li>
<li class="chapter" data-level="6.9" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#autostart-donkeycar"><i class="fa fa-check"></i><b>6.9</b> autostart donkeycar</a></li>
<li class="chapter" data-level="6.10" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#steering-calibration-1"><i class="fa fa-check"></i><b>6.10</b> Steering Calibration</a></li>
<li class="chapter" data-level="6.11" data-path="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html"><a href="installation-of-tawn-kramers-donkeycar-version-by-rainer-bareiß.html#drive"><i class="fa fa-check"></i><b>6.11</b> drive</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><i class="fa fa-check"></i><b>7</b> Driving &amp; Training following Tawn Kramer (By Rainer Bareiß)</a><ul>
<li class="chapter" data-level="7.1" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#environment-1"><i class="fa fa-check"></i><b>7.1</b> Environment</a></li>
<li class="chapter" data-level="7.2" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#read-data-from-pi"><i class="fa fa-check"></i><b>7.2</b> Read data from pi</a></li>
<li class="chapter" data-level="7.3" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#check-data-raw-prepared"><i class="fa fa-check"></i><b>7.3</b> Check data raw &amp; prepared</a></li>
<li class="chapter" data-level="7.4" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#clean-data"><i class="fa fa-check"></i><b>7.4</b> 3. Clean data</a></li>
<li class="chapter" data-level="7.5" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#make-movie"><i class="fa fa-check"></i><b>7.5</b> Make movie</a></li>
<li class="chapter" data-level="7.6" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#tubhist"><i class="fa fa-check"></i><b>7.6</b> tubhist</a></li>
<li class="chapter" data-level="7.7" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#train-data"><i class="fa fa-check"></i><b>7.7</b> Train Data</a></li>
<li class="chapter" data-level="7.8" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#plot-data-against-model"><i class="fa fa-check"></i><b>7.8</b> Plot data against model</a></li>
<li class="chapter" data-level="7.9" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#run-in-simulator"><i class="fa fa-check"></i><b>7.9</b> Run in simulator</a></li>
<li class="chapter" data-level="7.10" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#copy-model-to-pi"><i class="fa fa-check"></i><b>7.10</b> Copy model to pi</a></li>
<li class="chapter" data-level="7.11" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#run-model-on-pi"><i class="fa fa-check"></i><b>7.11</b> Run model on pi</a></li>
<li class="chapter" data-level="7.12" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#watch-pi-camera"><i class="fa fa-check"></i><b>7.12</b> 11. Watch pi camera</a></li>
<li class="chapter" data-level="7.13" data-path="driving-training-following-tawn-kramer-by-rainer-bareiß.html"><a href="driving-training-following-tawn-kramer-by-rainer-bareiß.html#reinfocement-learning"><i class="fa fa-check"></i><b>7.13</b> Reinfocement Learning</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="robocarLogBook.html"><a href="robocarLogBook.html"><i class="fa fa-check"></i><b>8</b> RoboCar Logbook</a><ul>
<li class="chapter" data-level="8.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#section"><i class="fa fa-check"></i><b>8.1</b> 15-02-2018</a><ul>
<li class="chapter" data-level="8.1.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#donkey-findcar"><i class="fa fa-check"></i><b>8.1.1</b> donkey findcar</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="robocarLogBook.html"><a href="robocarLogBook.html#build-sunfounder-car-17-02-2018"><i class="fa fa-check"></i><b>8.2</b> Build sunfounder car 17-02-2018</a><ul>
<li class="chapter" data-level="8.2.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#install-software-18-02-2018"><i class="fa fa-check"></i><b>8.2.1</b> install software 18-02-2018</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="robocarLogBook.html"><a href="robocarLogBook.html#viewing-a-list-of-available-python-versions"><i class="fa fa-check"></i><b>8.3</b> Viewing a list of available Python versions</a></li>
<li class="chapter" data-level="8.4" data-path="robocarLogBook.html"><a href="robocarLogBook.html#run-calibration"><i class="fa fa-check"></i><b>8.4</b> Run calibration</a></li>
<li class="chapter" data-level="8.5" data-path="robocarLogBook.html"><a href="robocarLogBook.html#mjpg-streamer-installation"><i class="fa fa-check"></i><b>8.5</b> MJPG-streamer Installation</a><ul>
<li class="chapter" data-level="8.5.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#testing"><i class="fa fa-check"></i><b>8.5.1</b> Testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="get-on-the-road.html"><a href="get-on-the-road.html"><i class="fa fa-check"></i><b>9</b> Get on the Road!</a><ul>
<li class="chapter" data-level="9.1" data-path="get-on-the-road.html"><a href="get-on-the-road.html#install-carnd-term1"><i class="fa fa-check"></i><b>9.1</b> install carnd-term1</a></li>
<li class="chapter" data-level="9.2" data-path="get-on-the-road.html"><a href="get-on-the-road.html#install-xbox-360-controller"><i class="fa fa-check"></i><b>9.2</b> Install Xbox 360 controller</a></li>
<li class="chapter" data-level="9.3" data-path="get-on-the-road.html"><a href="get-on-the-road.html#implement-xbox-controller-as-input-in-client_app.py"><i class="fa fa-check"></i><b>9.3</b> Implement Xbox controller as input in client_App.py</a><ul>
<li class="chapter" data-level="9.3.1" data-path="get-on-the-road.html"><a href="get-on-the-road.html#make-steering-proportional-to-remote-control-lever-position"><i class="fa fa-check"></i><b>9.3.1</b> Make steering proportional to remote control lever position</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="get-on-the-road.html"><a href="get-on-the-road.html#GetIp"><i class="fa fa-check"></i><b>9.4</b> Get IP adress of raspi in shack</a></li>
<li class="chapter" data-level="9.5" data-path="get-on-the-road.html"><a href="get-on-the-road.html#store-snapshots-of-video-stream-on-local-computer"><i class="fa fa-check"></i><b>9.5</b> Store snapshots of video stream on local computer</a><ul>
<li class="chapter" data-level="9.5.1" data-path="get-on-the-road.html"><a href="get-on-the-road.html#jie-hous-alternative"><i class="fa fa-check"></i><b>9.5.1</b> Jie Hou’s alternative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>10</b> Resources</a><ul>
<li class="chapter" data-level="10.1" data-path="resources.html"><a href="resources.html#meetups"><i class="fa fa-check"></i><b>10.1</b> Meetups</a><ul>
<li class="chapter" data-level="10.1.1" data-path="resources.html"><a href="resources.html#esslinger-makerspace-projekt-autonomen-robocar-bauen"><i class="fa fa-check"></i><b>10.1.1</b> Esslinger Makerspace Projekt: Autonomen RoboCar bauen</a></li>
<li class="chapter" data-level="10.1.2" data-path="resources.html"><a href="resources.html#autonomous-mobility-berlin"><i class="fa fa-check"></i><b>10.1.2</b> Autonomous Mobility Berlin</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="resources.html"><a href="resources.html#robocar-projects"><i class="fa fa-check"></i><b>10.2</b> RoboCar projects</a><ul>
<li class="chapter" data-level="10.2.1" data-path="resources.html"><a href="resources.html#diy-robocars"><i class="fa fa-check"></i><b>10.2.1</b> DIY RoboCars</a></li>
<li class="chapter" data-level="10.2.2" data-path="resources.html"><a href="resources.html#donkey-car"><i class="fa fa-check"></i><b>10.2.2</b> Donkey car</a></li>
<li class="chapter" data-level="10.2.3" data-path="resources.html"><a href="resources.html#sunfounder-smart-video-car-kit-for-raspberry-pi-with-android-app"><i class="fa fa-check"></i><b>10.2.3</b> Sunfounder Smart Video Car Kit for Raspberry Pi with Android App</a></li>
<li class="chapter" data-level="10.2.4" data-path="resources.html"><a href="resources.html#kuman-professional-wifi-smart-robot-model-car-kit-videokamera-for-raspberry-pi-3"><i class="fa fa-check"></i><b>10.2.4</b> Kuman Professional WIFI Smart Robot Model Car Kit Videokamera for Raspberry Pi 3</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="resources.html"><a href="resources.html#hardware"><i class="fa fa-check"></i><b>10.3</b> Hardware</a><ul>
<li class="chapter" data-level="10.3.1" data-path="resources.html"><a href="resources.html#komponentenliste-für-ein-ferngesteuertes-roboter-auto"><i class="fa fa-check"></i><b>10.3.1</b> KOMPONENTENLISTE FÜR EIN FERNGESTEUERTES ROBOTER AUTO</a></li>
<li class="chapter" data-level="10.3.2" data-path="resources.html"><a href="resources.html#motor-control"><i class="fa fa-check"></i><b>10.3.2</b> Motor control</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="resources.html"><a href="resources.html#simulators"><i class="fa fa-check"></i><b>10.4</b> Simulators</a><ul>
<li class="chapter" data-level="10.4.1" data-path="resources.html"><a href="resources.html#donkey-simulator"><i class="fa fa-check"></i><b>10.4.1</b> Donkey Simulator</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="resources.html"><a href="resources.html#software"><i class="fa fa-check"></i><b>10.5</b> Software</a><ul>
<li class="chapter" data-level="10.5.1" data-path="resources.html"><a href="resources.html#udacitiy-open-source-sdc"><i class="fa fa-check"></i><b>10.5.1</b> Udacitiy open source SDC</a></li>
<li class="chapter" data-level="10.5.2" data-path="resources.html"><a href="resources.html#connect-raspberry-with-xbox-controller"><i class="fa fa-check"></i><b>10.5.2</b> connect raspberry with xbox controller</a></li>
<li class="chapter" data-level="10.5.3" data-path="resources.html"><a href="resources.html#raspberry-pi-rc-control"><i class="fa fa-check"></i><b>10.5.3</b> RASPBERRY PI RC CONTROL</a></li>
<li class="chapter" data-level="10.5.4" data-path="resources.html"><a href="resources.html#python-class-to-support-xbox-360-controller-under-linux-on-raspberrypi"><i class="fa fa-check"></i><b>10.5.4</b> Python class to support xbox 360 controller under Linux on RaspberryPi</a></li>
<li class="chapter" data-level="10.5.5" data-path="resources.html"><a href="resources.html#xbox-driver-for-mac"><i class="fa fa-check"></i><b>10.5.5</b> xbox driver for mac</a></li>
<li class="chapter" data-level="10.5.6" data-path="resources.html"><a href="resources.html#konzept-für-softwareschichten"><i class="fa fa-check"></i><b>10.5.6</b> Konzept für softwareschichten</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="experiences.html"><a href="experiences.html"><i class="fa fa-check"></i><b>11</b> Experiences gathered</a><ul>
<li class="chapter" data-level="11.1" data-path="experiences.html"><a href="experiences.html#install-donkey-car-on-mac"><i class="fa fa-check"></i><b>11.1</b> Install donkey car on Mac</a></li>
<li class="chapter" data-level="11.2" data-path="experiences.html"><a href="experiences.html#donkey-car-simulator"><i class="fa fa-check"></i><b>11.2</b> Donkey car simulator</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Theory.html"><a href="Theory.html"><i class="fa fa-check"></i><b>12</b> Theory</a><ul>
<li class="chapter" data-level="12.1" data-path="Theory.html"><a href="Theory.html#wiring-of-pca9685-with-l298n-h-bridge"><i class="fa fa-check"></i><b>12.1</b> Wiring of PCA9685 with L298N H-bridge</a></li>
<li class="chapter" data-level="12.2" data-path="Theory.html"><a href="Theory.html#sensor-fusion-of-lidar-and-camera-data"><i class="fa fa-check"></i><b>12.2</b> sensor fusion of LIDAR and camera data</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="UsefulLinks.html"><a href="UsefulLinks.html"><i class="fa fa-check"></i><b>13</b> Useful links</a><ul>
<li class="chapter" data-level="13.1" data-path="UsefulLinks.html"><a href="UsefulLinks.html#donkey-car-1"><i class="fa fa-check"></i><b>13.1</b> Donkey car</a><ul>
<li class="chapter" data-level="13.1.1" data-path="UsefulLinks.html"><a href="UsefulLinks.html#videos-for-donkey-car"><i class="fa fa-check"></i><b>13.1.1</b> Videos for donkey car</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="UsefulLinks.html"><a href="UsefulLinks.html#parts-to-build-a-robocar"><i class="fa fa-check"></i><b>13.2</b> Parts to build a RoboCar</a></li>
<li class="chapter" data-level="13.3" data-path="UsefulLinks.html"><a href="UsefulLinks.html#little-setup-helpers"><i class="fa fa-check"></i><b>13.3</b> Little setup helpers</a></li>
<li class="chapter" data-level="13.4" data-path="UsefulLinks.html"><a href="UsefulLinks.html#meetup-in-stuttgart-area"><i class="fa fa-check"></i><b>13.4</b> Meetup in Stuttgart area</a></li>
<li class="chapter" data-level="13.5" data-path="UsefulLinks.html"><a href="UsefulLinks.html#robocar-projects-1"><i class="fa fa-check"></i><b>13.5</b> RoboCar projects</a></li>
<li class="chapter" data-level="13.6" data-path="UsefulLinks.html"><a href="UsefulLinks.html#write-ups-on-donkeycar-projects"><i class="fa fa-check"></i><b>13.6</b> Write ups on Donkeycar projects</a></li>
<li class="chapter" data-level="13.7" data-path="UsefulLinks.html"><a href="UsefulLinks.html#other-stuff"><i class="fa fa-check"></i><b>13.7</b> Other stuff</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/RoboCarEsslingen" target="blank">Related files on Github</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">RoboCar project documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="donkeyCar" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Building and operate a donkeycar</h1>
<p>In December 2018 I switched from sunfounder to donkeycar
<a href="http://www.donkeycar.com" title="Donkey Car&#39;s Homepage">Donkey Car</a></p>
<div id="reason-for-changing-the-plattform" class="section level2">
<h2><span class="header-section-number">2.1</span> Reason for changing the plattform</h2>
<p>The sunfounder was wonderful to learn the basics, PWM, I2C, use of camera with Pi, but had shortcomings in the steering mechanism. The steering angle was not reproducible, i.e. sending twice the same steering command did result in different steering angles of about a few degrees difference. Now since the aim of the game is to train a neural net which takes the commanded steering angle as ground truth this was a show stopper for me and therefore i moved to =&gt; Donkey Car</p>
<p>Second reason, other members of the group <a href="https://www.meetup.com/Esslingen-Makerspace/" title="Homepage of the meetup">Esslinger Makerspace Projekt: Autonomen RoboCar bauen</a> opted for donkey car.</p>
<div id="carSelection" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Selecting a RC car</h3>
<p>Selection criteria for RC car are:</p>
<ul>
<li>Brushed motor =&gt; no need for high speed</li>
<li>NiMH battery =&gt; less sensitive to mechanical impact compared to Li-ion battery</li>
<li>ESC not integrated into remote control receiver</li>
<li>3 wire steering servo</li>
</ul>
<p>A great buying guide for RC-cars from the donkeycar project can be found at <a href="http://docs.donkeycar.com/roll_your_own/" class="uri">http://docs.donkeycar.com/roll_your_own/</a></p>
<p>I changed to <a href="https://www.conrad.de/de/reely-dart-20-brushed-110-rc-modellauto-elektro-buggy-heckantrieb-100-premium-rtr-24-ghz-inkl-akku-ladegeraet-und-s-1605712.html">Reely Dart 2.0 Brushed</a>
Tamiya-Buchse is the connector of the NiMH battery
Charger is <a href="https://www.voelkner.de/products/873118/VOLTCRAFT-Modellbau-Ladegeraet-230V-3A-V-Charge-Eco-NiMh-3000-NiMH-NiCd.html?ref=43&amp;gclid=Cj0KCQiAoo7gBRDuARIsANeJKUY9VcxYcAKJaeCDBPf9sg6MXEd316L1nYbbPL-Y-BZesMLOi7MQGoYaAuewEALw_wcB">Voltcraft V-Charge Eco NiMh 3000</a></p>
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="images/Donkey3DPrint.jpg" alt="Reely Dart 2.0 Brushed converted RoboCar" width="2016" />
<p class="caption">
Figure 2.1: Reely Dart 2.0 Brushed converted RoboCar
</p>
</div>
</div>
</div>
<div id="what-to-do" class="section level2">
<h2><span class="header-section-number">2.2</span> What to do</h2>
<ul>
<li>disassemble the sunfounder, by taking of the plate on which the raspberry is mounted</li>
<li>disassemble the L298N H-bridge, not needed if you use an <a href="https://en.wikipedia.org/wiki/Electronic_speed_control">ESC</a></li>
<li>Rewire the PWM signal of the car
<ul>
<li>channel 1 =&gt; steering</li>
<li>channel 0 =&gt; throttle</li>
</ul></li>
<li><a href="http://docs.donkeycar.com/guide/install_software/#get-the-raspberry-pi-working">Install Software on Pi and Host Computer</a>
<ul>
<li>Setup Raspberry Pi</li>
<li>Setup Mac Host PC (or windows or Linux host)</li>
</ul></li>
<li><a href="http://docs.donkeycar.com/guide/calibrate/">Calibrate your car</a></li>
<li><a href="http://docs.donkeycar.com/guide/get_driving/">Drive your car</a></li>
<li><a href="http://docs.donkeycar.com/guide/train_autopilot/">Train an autopilot with Keras</a></li>
<li><p><a href="http://docs.donkeycar.com/guide/simulator/">http://docs.donkeycar.com/guide/simulator/</a></p></li>
<li><p>Select web or physical controller <a href="http://docs.donkeycar.com/parts/controllers/#physical-joystick-controller">Controller Parts</a></p></li>
</ul>
</div>
<div id="carWiring" class="section level2">
<h2><span class="header-section-number">2.3</span> Rewiring the car</h2>
<p>The rewiring consists of</p>
<ul>
<li>Disconnect the following connections
<ul>
<li>PWM signal RC receiver =&gt; Steering Servo</li>
<li>PWM signal RC receiver =&gt; ESC</li>
</ul></li>
<li>Connect
<ul>
<li>Battery =&gt; DC/DC converter</li>
<li>DC/DC converter =&gt; Raspberry Pi</li>
<li>PWM Servo Hat onto Raspberry Pi</li>
<li>PWM Servo Hat Ch 0 =&gt; ESC</li>
<li>PWM Servo Hat Ch 1 =&gt; Steering Servo</li>
<li>Raspberry Pi =&gt; Raspberry Pi camera</li>
</ul></li>
</ul>
<p>The resulting wiring diagram can be seen in figure <a href="donkeyCar.html#fig:wiringDiagram">2.2</a></p>
<div class="figure"><span id="fig:wiringDiagram"></span>
<img src="images/DonkeyCarRewiringI.png" alt="Wiring diagram after rewiring car" width="827" />
<p class="caption">
Figure 2.2: Wiring diagram after rewiring car
</p>
</div>
<p><strong>WARNING, don’t connect the red wire of the ESC to PWM Servo Hat, only the other two wires are needed between ESC to PWM Servo Hat</strong></p>
<p>So there are only the PWM signal wires from the PWM Servo Hat to the car and the power supply needs to be connected to the DC/DC converter. A close-up on the PWM Servo Hat is given in figure <a href="donkeyCar.html#fig:closeUpPwmHat">2.3</a></p>
<div class="figure"><span id="fig:closeUpPwmHat"></span>
<img src="images/ServoHat.jpg" alt="Close-up of PWM Servo Hat"  />
<p class="caption">
Figure 2.3: Close-up of PWM Servo Hat
</p>
</div>
<p>You can eliminate the RC receiver altogether, see figure <a href="donkeyCar.html#fig:rewireSimple">2.4</a></p>
<div class="figure"><span id="fig:rewireSimple"></span>
<img src="images/RewiringSimple.png" alt="Rewiring without RC receiver"  />
<p class="caption">
Figure 2.4: Rewiring without RC receiver
</p>
</div>
<p><strong>WARNING, don’t connect the red wire of the ESC to PWM Servo Hat, only the other two wires are needed between ESC to PWM Servo Hat</strong></p>
<div id="parts-list" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Parts list</h3>
<p>The following list is what I used to build the car, this does not mean there are better and/or cheaper options available. In total the cost is about 250€.</p>
<ul>
<li><a href="https://www.conrad.de/de/reely-dart-20-brushed-110-rc-modellauto-elektro-buggy-heckantrieb-100-premium-rtr-24-ghz-inkl-akku-ladegeraet-und-s-1605712.html">Reely Dart 2.0 Brushed</a> ca. 130€</li>
<li><a href="https://www.reichelt.de/raspberry-pi-3-b-4x-1-2-ghz-1-gb-ram-wlan-bt-raspberry-pi-3-p164977.html?r=1">Raspberry Pi</a> ca. 34€</li>
<li><a href="https://www.amazon.de/dp/B00N1YJKFS/ref=pe_3044161_189395811_TE_dp_1">Raspbery Pi camera</a> ca. 25€</li>
<li><a href="https://www.amazon.de/gp/product/B01185WQXY?ref=em_1p_0_ti&amp;ref_=pe_2444481_339394281">PWM Servo Hat</a> ca. 32€</li>
<li><a href="https://www.reichelt.de/entwicklerboards-spannungsregler-6-40-v-dc-auf-2x-usb-5v-3a-debo-dc-2xusb-p242778.html?PROVID=2788&amp;gclid=CjwKCAiA4OvhBRAjEiwAU2FoJaCWbrXYqhuMADE3wArHLnltplldPHPumAXmfit7bQZUbyxtnIbwhRoCvqAQAvD_BwE&amp;&amp;r=1">DC/DC converter</a> ca. 4€,</li>
<li><a href="https://www.amazon.de/dp/B06XSB2TXQ/ref=pe_3044161_185740101_TE_item">WiiU controller</a> ca. 18€</li>
<li><p><a href="https://www.amazon.de/gp/product/B01I1N73TI/ref=ppx_yo_dt_b_asin_title_o04__o00_s00?ie=UTF8&amp;psc=1">Tamiya Stecker Power wires</a> ca. 9€</p></li>
<li><p>Stuff to mechanically integrate the new elements into the car.</p></li>
</ul>
</div>
<div id="why-not-using-pca9685" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Why not using PCA9685</h3>
<p><strong>Note</strong>, there seems to be an issue with driving two servos with PCA9685 at the same time. What happens is that steering and throttle work during calibration but not when the car is controlled via the web interface. TBC</p>
<p>A possible cure is described at <a href="https://cdn-learn.adafruit.com/downloads/pdf/adafruit-16-channel-servo-driver-with-raspberry-pi.pdf">Adafruit 16 Channel Servo Driver with Raspberry Pi</a>.</p>
<blockquote>
<p>When to add an optional Capacitor to the driver board
We have a spot on the PCB for soldering in an electrolytic capacitor. Based on your usage, you may or may not need a
capacitor. If you are driving a lot of servos from a power supply that dips a lot when the servos move, n * 100uF where n is the number of servos is a good place to start - eg 470uF or more for 5 servos. Since its so dependent on servo current draw, the torque on each motor, and what power supply, there is no “one magic capacitor value” we can suggest which is why we don’t include a capacitor in the kit.</p>
</blockquote>
<p>I did <strong>not</strong> check whether this works.</p>
<p>The now used <a href="https://www.amazon.de/gp/product/B01185WQXY?ref=em_1p_0_ti&amp;ref_=pe_2444481_339394281">PWM SERVO HAT 2327 By ADAFRUIT INDUSTRIES</a> did not show any problem controlling two channels at the same time</p>
</div>
</div>
<div id="folders-created-during-installation-of-host-pc" class="section level2">
<h2><span class="header-section-number">2.4</span> Folders created during installation of host PC</h2>
<ul>
<li>/Users/uwesterr/mycar/models</li>
<li>/Users/uwesterr/mycar/data</li>
<li>/Users/uwesterr/mycar/logs</li>
</ul>
</div>
<div id="calibrate-the-car" class="section level2">
<h2><span class="header-section-number">2.5</span> Calibrate the car</h2>
<p>Instructions for the calibrations can be found at <a href="http://docs.donkeycar.com/guide/calibrate/#calibrate-your-car" class="uri">http://docs.donkeycar.com/guide/calibrate/#calibrate-your-car</a></p>
<p>ssh into your raspberry</p>
<div id="setting-wifi-up-for-the-raspberry" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Setting WIFI up for the raspberry</h3>
<p>To set up the WiFi connection on the raspberry you find a detailed description at
<a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md" title="DOCUMENTATION &gt; CONFIGURATION &gt; WIRELESS &gt; WIRELESS-CLI">SETTING WIFI UP VIA THE COMMAND LINE</a></p>
</div>
<div id="steering-calibration" class="section level3">
<h3><span class="header-section-number">2.5.2</span> Steering Calibration</h3>
<p>To start steering calibration run</p>
<pre><code>donkey calibrate --channel &lt;your_steering_channel&gt;</code></pre>
<p>PWM channel 1 for steering</p>
<pre><code>donkey calibrate --channel 1</code></pre>
<pre><code>(env) pi@donkeypi_uwe:~ $ donkey calibrate --channel 1
using donkey version: 2.5.8 ...
Enter a PWM setting to test(0-1500)360
Enter a PWM setting to test(0-1500)120     
.
.
.</code></pre>
<p><code>Ctrl C</code> to exit calibration mode</p>
<p>Values for my car:</p>
<ul>
<li>left:490</li>
<li>right: 390</li>
<li>stop 410</li>
<li>slow forward 440</li>
<li>slow reverse 390</li>
<li>fast forward 550</li>
<li>fast reverse 310</li>
</ul>
</div>
<div id="throttle-calibration" class="section level3">
<h3><span class="header-section-number">2.5.3</span> Throttle Calibration</h3>
<p>To start throttle calibration run</p>
<pre><code>donkey calibrate --channel &lt;your_throttle_channel&gt;</code></pre>
<p>PWM channel 0 for throttle</p>
<pre><code>(env) pi@donkeypi_uwe:~ $ donkey calibrate --channel 0
using donkey version: 2.5.8 ...
Enter a PWM setting to test(0-1500)400
Enter a PWM setting to test(0-1500)420
Enter a PWM setting to test(0-1500)400
Enter a PWM setting to test(0-1500)380</code></pre>
</div>
<div id="configpyAfterCalib" class="section level3">
<h3><span class="header-section-number">2.5.4</span> Config.py after calibration</h3>
<p>after configuration the <code>config.py</code> file reads</p>
<pre><code>&quot;&quot;&quot;
CAR CONFIG

This file is read by your car application&#39;s manage.py script to change the car
performance.

EXMAPLE
-----------
import dk
cfg = dk.load_config(config_path=&#39;~/mycar/config.py&#39;)
print(cfg.CAMERA_RESOLUTION)

&quot;&quot;&quot;


import os

#PATHS
CAR_PATH = PACKAGE_PATH = os.path.dirname(os.path.realpath(__file__))
DATA_PATH = os.path.join(CAR_PATH, &#39;data&#39;)
MODELS_PATH = os.path.join(CAR_PATH, &#39;models&#39;)

#VEHICLE
DRIVE_LOOP_HZ = 20
MAX_LOOPS = 100000

#CAMERA
CAMERA_RESOLUTION = (120, 160) #(height, width)
CAMERA_FRAMERATE = DRIVE_LOOP_HZ

#STEERING
STEERING_CHANNEL = 1
STEERING_LEFT_PWM = 460
STEERING_RIGHT_PWM = 370

#THROTTLE
THROTTLE_CHANNEL = 0
THROTTLE_FORWARD_PWM = 550
THROTTLE_STOPPED_PWM = 410
THROTTLE_REVERSE_PWM = 320

#TRAINING
BATCH_SIZE = 128
TRAIN_TEST_SPLIT = 0.8


#JOYSTICK
USE_JOYSTICK_AS_DEFAULT = False
JOYSTICK_MAX_THROTTLE = 0.25
JOYSTICK_STEERING_SCALE = 1.0
AUTO_RECORD_ON_THROTTLE = True


TUB_PATH = os.path.join(CAR_PATH, &#39;tub&#39;) # if using a single tub</code></pre>
</div>
</div>
<div id="drive-your-car-with-web-interface" class="section level2">
<h2><span class="header-section-number">2.6</span> Drive your car with web interface</h2>
<p>Instructions are at <a href="http://docs.donkeycar.com/guide/get_driving/" class="uri">http://docs.donkeycar.com/guide/get_driving/</a></p>
<div id="preparation-on-mac" class="section level3">
<h3><span class="header-section-number">2.6.1</span> Preparation on Mac</h3>
<ul>
<li>open terminal</li>
<li>Activate mappings to donkey Python setup with: <code>source activate donkey</code></li>
<li>Change to your local dir for managing donkey: <code>cd ~/mycar</code></li>
</ul>
</div>
<div id="preparation-on-raspberry" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Preparation on Raspberry</h3>
<pre><code>cd ~/mycar
python manage.py drive</code></pre>
<p>in the terminal window that looks like follows:</p>
<pre><code>(env) pi@donkeypi_uwe:~/mycar $ python manage.py drive

using donkey version: 2.5.8 ...
/usr/lib/python3/dist-packages/h5py/__init__.py:34: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  from ._conv import register_converters as _register_converters
loading config file: /home/pi/mycar/config.py
config loaded
PiCamera loaded.. .warming camera
Starting Donkey Server...
You can now go to http://127.0.0.1:8887 to drive your car.
/home/pi/env/lib/python3.5/site-packages/picamera/encoders.py:544: PiCameraResolutionRounded: frame size rounded up from 160x120 to 160x128
  width, height, fwidth, fheight)))</code></pre>
</div>
<div id="open-control-in-web-browser-on-mac" class="section level3">
<h3><span class="header-section-number">2.6.3</span> Open control in web browser on Mac</h3>
<p>You can now control your car from a web browser at the URL: <code>192.168.178.67:8887</code></p>
</div>
</div>
<div id="connecting-bluetooth-controller" class="section level2">
<h2><span class="header-section-number">2.7</span> Connecting bluetooth controller</h2>
<p>I got an Wii U second hand <a href="https://www.amazon.de/gp/product/B06XSB2TXQ/ref=oh_aui_detailpage_o01_s00?ie=UTF8&amp;psc=1">WiiU controller</a>, therefore I did select the <a href="http://docs.donkeycar.com/parts/controllers/">Controllers page</a> the <a href="https://github.com/autorope/donkeypart_bluetooth_game_controller">WiiU controller</a></p>
<p>After ssh into the raspberry install <strong>Bluetooth Game Controller</strong> library</p>
<pre><code>git clone https://github.com/autorope/donkeypart_bluetooth_game_controller.git
pip install -e ./donkeypart_bluetooth_game_controller</code></pre>
<div id="BluetoothControllerInstall" class="section level3">
<h3><span class="header-section-number">2.7.1</span> Connect your bluetooth controller to the raspberry pi.</h3>
<ol style="list-style-type: decimal">
<li>Start the Bluetooth bash tool on your raspberry pi.</li>
</ol>
<pre><code>sudo bluetoothctl
power on
scan on</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Turn on your controller in scan mode and look for your controllers name in the bluetoothctl scan results. This is done by turning over the controller and pushing the sync button until the 4 blue buttons blink</li>
</ol>
<p>In the shell the scan showed
&gt; [NEW] Device 0C:FC:83:97:A6:4F Nintendo RVL-CNT-01</p>
<ol start="3" style="list-style-type: decimal">
<li>Connect to your controller using its id (my controller id is <code>0C:FC:83:97:A6:4F</code>) once you’ve found it’s id. You may have to run these commands several times.</li>
</ol>
<pre><code> pair 0C:FC:83:97:A6:4F 
 connect 0C:FC:83:97:A6:4F
 trust 0C:FC:83:97:A6:4F</code></pre>
<p>Now your controller should show that your controller is connected - the 4 blinking lights turns to one solid light.</p>
<p>Run the part script to see if it works. You should see all the button values printed as you press them. Like this.</p>
<pre><code>cd donkeypart_bluetooth_game_controller/donkeypart_bluetooth_game_controller
(env) pi@donkeypi_uwe:~/donkeypart_bluetooth_game_controller/donkeypart_bluetooth_game_controller $ python part.py log
Please give a string that can identify the bluetooth device (ie. nintendo)nintendo
log
device /dev/input/event0, name &quot;Nintendo Wii Remote Pro Controller&quot;, phys &quot;&quot;
button: LEFT_STICK_X, value:-0.009375
button: LEFT_STICK_X, value:-0.0015625
button: LEFT_STICK_X, value:-0.00390625
button: LEFT_STICK_X, value:-0.00546875
button: LEFT_STICK_X, value:-0.00703125</code></pre>
<p>How to add the Bluetooth controller into <code>manage.py</code>is described in section <a href="donkeyCarSoftwareAnalysis.html#AddBluetooth">5.1.3.3</a></p>
<p>In the file <code>manageOrgExtWii.py</code> the Bluetooth controller was integrated.</p>
</div>
</div>
<div id="start-driving-or-training" class="section level2">
<h2><span class="header-section-number">2.8</span> Start driving or training</h2>
<p>Before start driving it might be a good idea to <strong>limit the max velocity</strong>, this can be done as described in <a href="donkeyCarSoftwareAnalysis.html#setMaxVel">5.5</a></p>
<ul>
<li>Power up donkeycar</li>
<li>Wait about 10s until Raspberry Pi is booted</li>
<li>Switch on Bluetooth controller
<ul>
<li>for Nintendo Wii controller</li>
<li>the four blue LEDs flash a few times</li>
<li>the left most LED solid shows that controller is connected with Raspberry Pi</li>
</ul></li>
</ul>
<p>Once controller is connected proceed as described in <a href="https://docs.donkeycar.com/guide/get_driving/">instructions</a></p>
<pre><code>ssh pi@&lt;your_pi_ip_address&gt;
# or
ssh pi@donkeypi-uwe

cd ~/mycar
python manage.py drive
# or if you have changed the file name to indicate that you added the bluetooth contorller
python manageOrgExtWii.py drive</code></pre>
<p>how to the the IP address of your car you check your at your router. How to do this at shackspace is described <a href="get-on-the-road.html#GetIp">9.4</a></p>
<p>And the car drives</p>
<video width="720" controls>
<source src="images/firstTryDonkeyCar.mp4" type="video/mp4">
</video>
<p>add Bluetooth controller to <code>manage.py</code> <a href="https://github.com/autorope/donkey2_plus/blob/690ff1b78c49c2a3dd4c1095bfcac9673f150804/manage.py" class="uri">https://github.com/autorope/donkey2_plus/blob/690ff1b78c49c2a3dd4c1095bfcac9673f150804/manage.py</a></p>
<div id="create-movie-from-tub-data" class="section level3">
<h3><span class="header-section-number">2.8.1</span> Create movie from tub data</h3>
<p>To create a movie from the gathered data</p>
<pre><code>donkey makemovie &lt;tub_path&gt; [--out=&lt;tub_movie.mp4&gt;]
# for example create movie tubMovie.mp4 from data located at tub
source activate donkey
donkey makemovie --tub tub --out tubMovie.mp4   </code></pre>
<p>More details at <a href="http://docs.donkeycar.com/utility/donkey/#make-movie-from-tub" class="uri">http://docs.donkeycar.com/utility/donkey/#make-movie-from-tub</a></p>
</div>
<div id="options-of-manage.py" class="section level3">
<h3><span class="header-section-number">2.8.2</span> Options of manage.py</h3>
<p>The script <code>manage.py</code> can be called with several options, to find them type</p>
<pre><code>(env) pi@donkeypi_uwe:~/mycar $ python manage.py drive --h</code></pre>
<blockquote>
<p>using donkey version: 2.5.8 …
/usr/lib/python3/dist-packages/h5py/<strong>init</strong>.py:34: FutureWarning: Conversion of the second argument of issubdtype from <code>float</code> to <code>np.floating</code> is deprecated. In future, it will be treated as <code>np.float64 == np.dtype(float).type</code>.
from ._conv import register_converters as _register_converters
Scripts to drive a donkey 2 car and train a model for it.</p>
</blockquote>
<pre><code>Usage:
    manage.py (drive) [--model=&lt;model&gt;] [--js] [--chaos]
    manage.py (train) [--tub=&lt;tub1,tub2,..tubn&gt;]  (--model=&lt;model&gt;) [--base_model=&lt;base_model&gt;] [--no_cache]

Options:
    -h --help        Show this screen.
    --tub TUBPATHS   List of paths to tubs. Comma separated. Use quotes to use wildcards. ie &quot;~/tubs/*&quot;
    --js             Use physical joystick.
    --chaos          Add periodic random steering when manually driving</code></pre>
</div>
</div>
<div id="tips-on-how-to-drive-during-training" class="section level2">
<h2><span class="header-section-number">2.9</span> Tips on how to drive during training</h2>
<p>Here are a few tips on how to gather the necessary training data. The tips are based on a video by Tawn Kramer <a href="https://www.youtube.com/watch?v=4fXbDf_QWM4&amp;feature=youtu.be">Driving Tips to Train your Autonomous End-to-End NN Driver</a></p>
<ul>
<li>create about 10,000 images</li>
<li>four different driving modes, more don’t hurt</li>
<li>do some driving to get used to the control</li>
<li>divide training session into four parts
<ul>
<li>drive slowly precisely center of the lane
<ul>
<li>about two laps</li>
<li>about 10% of the data</li>
</ul></li>
<li>drive in lane with small oscillations
<ul>
<li>shows NN how track looks like at different angles</li>
<li>shows NN how to correct back to center</li>
<li>about 2-3 laps</li>
</ul></li>
<li>drive like you normally drive
<ul>
<li>speed a little bit</li>
<li>not always bang center of lane</li>
</ul></li>
<li>drive with slow oscillations
<ul>
<li>bounce back and forth between extremes of the lanes</li>
<li>help NN to establish the lane boundaries</li>
</ul></li>
</ul></li>
</ul>
<p>The resulting steering angle histogram is shown in figure <a href="donkeyCar.html#fig:steeringAngleHist">2.5</a></p>
<div class="figure"><span id="fig:steeringAngleHist"></span>
<img src="images/HistSteeringAngleTawn.png" alt="Steering angle histogramm of Tawn Kramer's training data" width="262" />
<p class="caption">
Figure 2.5: Steering angle histogramm of Tawn Kramer’s training data
</p>
</div>
<ul>
<li>About 50% are straight driving</li>
<li>Two humps from the oscillating driving</li>
<li>Right hump more prominent since course has more right bends</li>
</ul>
<div id="how-to-edit-recorded-data" class="section level3">
<h3><span class="header-section-number">2.9.1</span> How to edit recorded data</h3>
<p>The donkey car utility tubclean is described in chapter <a href="donkey-command-line-utilities.html#tubclean">4.6</a></p>
</div>
</div>
<div id="mange-recorded-data" class="section level2">
<h2><span class="header-section-number">2.10</span> Mange recorded data</h2>
<p>The training data is being stored in the folder /mycar/tub.</p>
<p>Since there might be a lot of data after a while you might want to</p>
<ul>
<li>delete</li>
<li>archive</li>
<li>copy it from the Raspberry Pi to your computer</li>
</ul>
<p>data</p>
<div id="archiving-data" class="section level3">
<h3><span class="header-section-number">2.10.1</span> Archiving data</h3>
<p>Archiving can be done by renaming the tub folder with the <code>mv</code> command. The <code>mv</code> command moves, or renames, files and directories on your file system. To move the <strong>tub</strong> folder, i.e rename it, to <strong>tubArchive</strong> use</p>
<pre><code>mv tub tubArchive</code></pre>
<p>more details on <code>mv</code> can be found at <a href="https://www.computerhope.com/unix/umv.htm" class="uri">https://www.computerhope.com/unix/umv.htm</a></p>
</div>
<div id="delete-data" class="section level3">
<h3><span class="header-section-number">2.10.2</span> Delete data</h3>
<p>Once you want to get rid of the data use the following command</p>
<pre><code>rm -rf tub</code></pre>
<p>More on <code>rm</code> can be found at <a href="https://www.computerhope.com/unix/urm.htm" class="uri">https://www.computerhope.com/unix/urm.htm</a></p>
</div>
<div id="copy-files-from-raspi-to-mac" class="section level3">
<h3><span class="header-section-number">2.10.3</span> Copy files from raspi to mac</h3>
<p>Open terminal on Mac
<a href="https://www.raspberrypi.org/documentation/remote-access/ssh/scp.md">Docy of scp command to copy file from pi to mac</a> run in terminal</p>
<pre><code>scp pi@192.168.178.67:mycar/manage.py</code></pre>
<p>then type the password of the pi, afterwards the the file <code>mycar/manage.py</code> is being copied to the current location. The current location can be found via the <code>pwd</code>command.</p>
<p>Or run <code>rsync</code>in terminal on Mac</p>
<pre><code>rsync -r pi@192.168.178.67:~/mycar/tub/  ~/mycar/tubMac/</code></pre>
<p>You will be prompted for the raspi password.
All files from the raspi folder <code>~/mycar/tub/</code> will be copied to the folder <code>~/mycar/tubMac/</code>on the Mac</p>
</div>
<div id="how-big-is-the-tub-folder" class="section level3">
<h3><span class="header-section-number">2.10.4</span> How big is the tub folder</h3>
<p>If you want to know how many MB of data you collected already use the <code>su</code> command. More info on the <code>su</code> command <a href="https://unix.stackexchange.com/questions/185764/how-do-i-get-the-size-of-a-directory-on-the-command-line">here</a></p>
<pre><code>(env) pi@donkeypi_uwe:~/mycar $ du -sh tub
232M    tub</code></pre>
</div>
</div>
<div id="train-neural-network" class="section level2">
<h2><span class="header-section-number">2.11</span> Train neural network</h2>
<p>A description is given in the <a href="http://docs.donkeycar.com/guide/train_autopilot/">donkeycar documentation</a>
Below an example for the case that all training data are located in a single folder named <code>tub</code>.</p>
<p>To train a neural network:</p>
<ul>
<li>change to directory where tub is located</li>
<li>activate donkey environment <code>source activate donkey</code></li>
</ul>
<p>run</p>
<pre><code>(donkey) Uwes-MacBook-Pro:mycar uwesterr$  python ~/mycar/manage.py train --tub tub --model ./models/mypilot</code></pre>
<p>which will place a model file called <code>mypilot</code> at</p>
<pre><code>(donkey) Uwes-MacBook-Pro:models uwesterr$ pwd
/Users/uwesterr/mycar/models
(donkey) Uwes-MacBook-Pro:models uwesterr$ ls
mypilot</code></pre>
<p>the command to train the neural network leads to the following output in the terminal window</p>
<pre><code>(donkey) Uwes-MacBook-Pro:mycar uwesterr$  python ~/mycar/manage.py train --tub tub --model ./models/mypilot
using donkey version: 2.5.7 ...
loading config file: /Users/uwesterr/mycar/config.py
config loaded
tub_names tub
train: 4497, validation: 1125
steps_per_epoch 35
Epoch 1/100
2019-04-12 16:14:59.549618: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
34/35 [============================&gt;.] - ETA: 0s - loss: 15.0006 - angle_out_loss: 12.5454 - throttle_out_loss: 17.4558    
Epoch 00001: val_loss improved from inf to 0.37914, saving model to ./models/mypilot
35/35 [==============================] - 29s 815ms/step - loss: 14.5843 - angle_out_loss: 12.2074 - throttle_out_loss: 16.9612 - val_loss: 0.3791 - val_angle_out_loss: 0.5718 - val_throttle_out_loss: 0.1865
Epoch 2/100
34/35 [============================&gt;.] - ETA: 0s - loss: 0.3353 - angle_out_loss: 0.5307 - throttle_out_loss: 0.1398 
Epoch 00002: val_loss improved from 0.37914 to 0.29204, saving model to ./models/mypilot
35/35 [==============================] - 31s 874ms/step - loss: 0.3338 - angle_out_loss: 0.5289 - throttle_out_loss: 0.1387 - val_loss: 0.2920 - val_angle_out_loss: 0.4629 - val_throttle_out_loss: 0.1212</code></pre>
</div>
<div id="run-car-on-neural-net" class="section level2">
<h2><span class="header-section-number">2.12</span> Run car on neural net</h2>
<p>Run the following command on the raspberry pi.</p>
<pre><code>(env) pi@donkeypi_uwe:~/mycar $ python manage.py drive --js --model ~/mycar/models/vaihingenIII.h5</code></pre>
<p>Toggle drive mode by pressing button <strong>‘A’</strong>, the modes are toggles between three states</p>
<ul>
<li><strong>Throttle</strong> and <strong>steering</strong> WiiU controlled</li>
<li><strong>Throttle</strong> WiiU controlled and <strong>steering</strong> controlled by neural net</li>
<li><strong>Throttle</strong> and <strong>steering</strong> controlled by neural net</li>
</ul>
<p>The modes have names and are defined:</p>
<ol style="list-style-type: lower-alpha">
<li><p>User : As you guessed, this is where you are in control of both the steering and throttle control.</p></li>
<li><p>Local Angle : Not too obvious, but this is where the trained model (mypilot from above) controls the steering. The Local refers to the trained model which is locally hosted on the raspberry-pi.</p></li>
<li><p>Local Pilot : This is where the trained model (mypilot) assumes control of both the steering and the throttle. As of now, it’s purportedly not very reliable.</p></li>
</ol>
<div id="change-model" class="section level3">
<h3><span class="header-section-number">2.12.1</span> change model</h3>
<p>change in</p>
<pre><code>/Users/uwesterr/CloudProjectsUnderWork/ProjectsUnderWork/RoboCar/donkeycar/donkeycar-1/donkeycar/parts/</code></pre>
<p>the file <code>keras.py</code>to tawn kramers <code>keras.py</code> which has dropout in the model. The file can be found at github <a href="https://github.com/tawnkramer/donkey/blob/master/donkeycar/parts/keras.py" class="uri">https://github.com/tawnkramer/donkey/blob/master/donkeycar/parts/keras.py</a></p>
<p>Model doesnt work with donkeycar installation on raspi, change to tawn kramer installation</p>
</div>
</div>
<div id="see-rainers-description" class="section level2">
<h2><span class="header-section-number">2.13</span> See Rainer’s description</h2>
<p><a href="https://github.com/tawnkramer/donkey/blob/master/docs/guide/install_software.md" class="uri">https://github.com/tawnkramer/donkey/blob/master/docs/guide/install_software.md</a></p>
<p>name of new installation donkeyUweTk</p>
<pre><code>(env) pi@donkeyUweTk:~/donkey/donkeycar/parts $ ls
__init__.py  augment.py   controller.py  dgym.py          graph.py  keras.py       network.py  simulation.py       transform.py
__pycache__  behavior.py  cv.py          encoder.py       image.py  led_status.py  ros.py      teensy.py           web_controller
actuator.py  camera.py    datastore.py   file_watcher.py  imu.py    lidar.py       salient.py  throttle_filter.py</code></pre>
<p>add Wii U controller instruction <a href="https://github.com/autorope/donkeypart_bluetooth_game_controller" class="uri">https://github.com/autorope/donkeypart_bluetooth_game_controller</a></p>
</div>
<div id="build-pre-processing-pipe-line" class="section level2">
<h2><span class="header-section-number">2.14</span> Build pre processing pipe line</h2>
<p>First step is to install openCV on the raspi so that the images recorded by the camera can be processed before they are stored.</p>
<div id="install-opencv-on-the-raspi" class="section level3">
<h3><span class="header-section-number">2.14.1</span> Install openCV on the raspi</h3>
<p>To add a pre-processing pipe line we need openCV. To intsall opencv on the raspberry
<code>pip install opencv-python</code></p>
</div>
</div>
<div id="bluetooth-key-mapping" class="section level2">
<h2><span class="header-section-number">2.15</span> bluetooth key mapping</h2>
<p>For Tawn Kramer’s version of donkeycar the following key mappings are valid for the Wii U</p>
<ul>
<li>X: erased last 100 records.</li>
<li>B: E-Stop!!!</li>
<li>“-” new mode: local_angle</li>
<li>again “-” new mode: local</li>
<li>Left cross:
<ul>
<li>up: increase throttle_scale</li>
<li>down decrease throttle_scale</li>
</ul></li>
</ul>
</div>
<div id="load-h5-model-and-inspect" class="section level2">
<h2><span class="header-section-number">2.16</span> Load h5 model and inspect</h2>
<pre><code>from tensorflow.python.keras.models import load_model

model1 = load_model(&quot;base_linearTawnKramer.h5&quot;)
model1.summary()</code></pre>
<p>you get</p>
<pre><code>__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
img_in (InputLayer)             (None, 120, 160, 3)  0                                            
__________________________________________________________________________________________________
cropping2d (Cropping2D)         (None, 120, 160, 3)  0           img_in[0][0]                     
__________________________________________________________________________________________________
batch_normalization_v1 (BatchNo (None, 120, 160, 3)  12          cropping2d[0][0]                 
__________________________________________________________________________________________________
conv2d_1 (Conv2D)               (None, 58, 78, 24)   1824        batch_normalization_v1[0][0]     
__________________________________________________________________________________________________
dropout (Dropout)               (None, 58, 78, 24)   0           conv2d_1[0][0]                   
__________________________________________________________________________________________________
conv2d_2 (Conv2D)               (None, 27, 37, 32)   19232       dropout[0][0]                    
__________________________________________________________________________________________________
dropout_1 (Dropout)             (None, 27, 37, 32)   0           conv2d_2[0][0]                   
__________________________________________________________________________________________________
conv2d_3 (Conv2D)               (None, 12, 17, 64)   51264       dropout_1[0][0]                  
__________________________________________________________________________________________________
dropout_2 (Dropout)             (None, 12, 17, 64)   0           conv2d_3[0][0]                   
__________________________________________________________________________________________________
conv2d_4 (Conv2D)               (None, 10, 15, 64)   36928       dropout_2[0][0]                  
__________________________________________________________________________________________________
dropout_3 (Dropout)             (None, 10, 15, 64)   0           conv2d_4[0][0]                   
__________________________________________________________________________________________________
conv2d_5 (Conv2D)               (None, 8, 13, 64)    36928       dropout_3[0][0]                  
__________________________________________________________________________________________________
dropout_4 (Dropout)             (None, 8, 13, 64)    0           conv2d_5[0][0]                   
__________________________________________________________________________________________________
flattened (Flatten)             (None, 6656)         0           dropout_4[0][0]                  
__________________________________________________________________________________________________
dense (Dense)                   (None, 100)          665700      flattened[0][0]                  
__________________________________________________________________________________________________
dropout_5 (Dropout)             (None, 100)          0           dense[0][0]                      
__________________________________________________________________________________________________
dense_1 (Dense)                 (None, 50)           5050        dropout_5[0][0]                  
__________________________________________________________________________________________________
dropout_6 (Dropout)             (None, 50)           0           dense_1[0][0]                    
__________________________________________________________________________________________________
n_outputs0 (Dense)              (None, 1)            51          dropout_6[0][0]                  
__________________________________________________________________________________________________
n_outputs1 (Dense)              (None, 1)            51          dropout_6[0][0]                  
==================================================================================================
Total params: 817,040
Trainable params: 817,034
Non-trainable params: 6
</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Conncectivity.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["RoboCarDokumentation.pdf", "RoboCarDokumentation.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
