<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 8 Donkeycar software analysis | RoboCar project documentation</title>
  <meta name="description" content="Notes taken by Uwe for the RoboCar project">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 8 Donkeycar software analysis | RoboCar project documentation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notes taken by Uwe for the RoboCar project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Donkeycar software analysis | RoboCar project documentation" />
  
  <meta name="twitter:description" content="Notes taken by Uwe for the RoboCar project" />
  

<meta name="author" content="Uwe Sterr">


<meta name="date" content="2019-01-15">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="donkeyCar.html">
<link rel="next" href="map-the-button-codes-to-the-button-names.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RoboCar project documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Project RoboCar</a></li>
<li class="chapter" data-level="2" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>2</b> Resources</a><ul>
<li class="chapter" data-level="2.1" data-path="resources.html"><a href="resources.html#meetups"><i class="fa fa-check"></i><b>2.1</b> Meetups</a><ul>
<li class="chapter" data-level="2.1.1" data-path="resources.html"><a href="resources.html#esslinger-makerspace-projekt-autonomen-robocar-bauen"><i class="fa fa-check"></i><b>2.1.1</b> Esslinger Makerspace Projekt: Autonomen RoboCar bauen</a></li>
<li class="chapter" data-level="2.1.2" data-path="resources.html"><a href="resources.html#autonomous-mobility-berlin"><i class="fa fa-check"></i><b>2.1.2</b> Autonomous Mobility Berlin</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="resources.html"><a href="resources.html#robocar-projects"><i class="fa fa-check"></i><b>2.2</b> RoboCar projects</a><ul>
<li class="chapter" data-level="2.2.1" data-path="resources.html"><a href="resources.html#diy-robocars"><i class="fa fa-check"></i><b>2.2.1</b> DIY RoboCars</a></li>
<li class="chapter" data-level="2.2.2" data-path="resources.html"><a href="resources.html#donkey-car"><i class="fa fa-check"></i><b>2.2.2</b> Donkey car</a></li>
<li class="chapter" data-level="2.2.3" data-path="resources.html"><a href="resources.html#sunfounder-smart-video-car-kit-for-raspberry-pi-with-android-app"><i class="fa fa-check"></i><b>2.2.3</b> Sunfounder Smart Video Car Kit for Raspberry Pi with Android App</a></li>
<li class="chapter" data-level="2.2.4" data-path="resources.html"><a href="resources.html#kuman-professional-wifi-smart-robot-model-car-kit-videokamera-for-raspberry-pi-3"><i class="fa fa-check"></i><b>2.2.4</b> Kuman Professional WIFI Smart Robot Model Car Kit Videokamera for Raspberry Pi 3</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="resources.html"><a href="resources.html#hardware"><i class="fa fa-check"></i><b>2.3</b> Hardware</a><ul>
<li class="chapter" data-level="2.3.1" data-path="resources.html"><a href="resources.html#komponentenliste-fur-ein-ferngesteuertes-roboter-auto"><i class="fa fa-check"></i><b>2.3.1</b> KOMPONENTENLISTE FÜR EIN FERNGESTEUERTES ROBOTER AUTO</a></li>
<li class="chapter" data-level="2.3.2" data-path="resources.html"><a href="resources.html#motor-control"><i class="fa fa-check"></i><b>2.3.2</b> Motor control</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="resources.html"><a href="resources.html#simulators"><i class="fa fa-check"></i><b>2.4</b> Simulators</a><ul>
<li class="chapter" data-level="2.4.1" data-path="resources.html"><a href="resources.html#donkey-simulator"><i class="fa fa-check"></i><b>2.4.1</b> Donkey Simulator</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="resources.html"><a href="resources.html#software"><i class="fa fa-check"></i><b>2.5</b> Software</a><ul>
<li class="chapter" data-level="2.5.1" data-path="resources.html"><a href="resources.html#udacitiy-open-source-sdc"><i class="fa fa-check"></i><b>2.5.1</b> Udacitiy open source SDC</a></li>
<li class="chapter" data-level="2.5.2" data-path="resources.html"><a href="resources.html#connect-raspberry-with-xbox-controller"><i class="fa fa-check"></i><b>2.5.2</b> connect raspberry with xbox controller</a></li>
<li class="chapter" data-level="2.5.3" data-path="resources.html"><a href="resources.html#raspberry-pi-rc-control"><i class="fa fa-check"></i><b>2.5.3</b> RASPBERRY PI RC CONTROL</a></li>
<li class="chapter" data-level="2.5.4" data-path="resources.html"><a href="resources.html#python-class-to-support-xbox-360-controller-under-linux-on-raspberrypi"><i class="fa fa-check"></i><b>2.5.4</b> Python class to support xbox 360 controller under Linux on RaspberryPi</a></li>
<li class="chapter" data-level="2.5.5" data-path="resources.html"><a href="resources.html#xbox-driver-for-mac"><i class="fa fa-check"></i><b>2.5.5</b> xbox driver for mac</a></li>
<li class="chapter" data-level="2.5.6" data-path="resources.html"><a href="resources.html#konzept-fur-softwareschichten"><i class="fa fa-check"></i><b>2.5.6</b> Konzept für softwareschichten</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="experiences.html"><a href="experiences.html"><i class="fa fa-check"></i><b>3</b> Experiences gathered</a><ul>
<li class="chapter" data-level="3.1" data-path="experiences.html"><a href="experiences.html#install-donkey-car-on-mac"><i class="fa fa-check"></i><b>3.1</b> Install donkey car on Mac</a></li>
<li class="chapter" data-level="3.2" data-path="experiences.html"><a href="experiences.html#donkey-car-simulator"><i class="fa fa-check"></i><b>3.2</b> Donkey car simulator</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Theory.html"><a href="Theory.html"><i class="fa fa-check"></i><b>4</b> Theory</a><ul>
<li class="chapter" data-level="4.1" data-path="Theory.html"><a href="Theory.html#wiring-of-pca9685-with-l298n-h-bridge"><i class="fa fa-check"></i><b>4.1</b> Wiring of PCA9685 with L298N H-bridge</a></li>
<li class="chapter" data-level="4.2" data-path="Theory.html"><a href="Theory.html#sensor-fusion-of-lidar-and-camera-data"><i class="fa fa-check"></i><b>4.2</b> sensor fusion of LIDAR and camera data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="robocarLogBook.html"><a href="robocarLogBook.html"><i class="fa fa-check"></i><b>5</b> RoboCar Logbook</a><ul>
<li class="chapter" data-level="5.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#section"><i class="fa fa-check"></i><b>5.1</b> 15-02-2018</a><ul>
<li class="chapter" data-level="5.1.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#donkey-findcar"><i class="fa fa-check"></i><b>5.1.1</b> donkey findcar</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="robocarLogBook.html"><a href="robocarLogBook.html#build-sunfounder-car-17-02-2018"><i class="fa fa-check"></i><b>5.2</b> Build sunfounder car 17-02-2018</a><ul>
<li class="chapter" data-level="5.2.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#install-software-18-02-2018"><i class="fa fa-check"></i><b>5.2.1</b> install software 18-02-2018</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="robocarLogBook.html"><a href="robocarLogBook.html#viewing-a-list-of-available-python-versions"><i class="fa fa-check"></i><b>5.3</b> Viewing a list of available Python versions</a></li>
<li class="chapter" data-level="5.4" data-path="robocarLogBook.html"><a href="robocarLogBook.html#run-calibration"><i class="fa fa-check"></i><b>5.4</b> Run calibration</a></li>
<li class="chapter" data-level="5.5" data-path="robocarLogBook.html"><a href="robocarLogBook.html#mjpg-streamer-installation"><i class="fa fa-check"></i><b>5.5</b> MJPG-streamer Installation</a><ul>
<li class="chapter" data-level="5.5.1" data-path="robocarLogBook.html"><a href="robocarLogBook.html#testing"><i class="fa fa-check"></i><b>5.5.1</b> Testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="get-on-the-road.html"><a href="get-on-the-road.html"><i class="fa fa-check"></i><b>6</b> Get on the Road!</a><ul>
<li class="chapter" data-level="6.1" data-path="get-on-the-road.html"><a href="get-on-the-road.html#install-carnd-term1"><i class="fa fa-check"></i><b>6.1</b> install carnd-term1</a></li>
<li class="chapter" data-level="6.2" data-path="get-on-the-road.html"><a href="get-on-the-road.html#install-xbox-360-controller"><i class="fa fa-check"></i><b>6.2</b> Install Xbox 360 controller</a></li>
<li class="chapter" data-level="6.3" data-path="get-on-the-road.html"><a href="get-on-the-road.html#implement-xbox-controller-as-input-in-client_app.py"><i class="fa fa-check"></i><b>6.3</b> Implement Xbox controller as input in client_App.py</a><ul>
<li class="chapter" data-level="6.3.1" data-path="get-on-the-road.html"><a href="get-on-the-road.html#make-steering-proportional-to-remote-control-lever-position"><i class="fa fa-check"></i><b>6.3.1</b> Make steering proportional to remote control lever position</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="get-on-the-road.html"><a href="get-on-the-road.html#GetIp"><i class="fa fa-check"></i><b>6.4</b> Get IP adress of raspi</a></li>
<li class="chapter" data-level="6.5" data-path="get-on-the-road.html"><a href="get-on-the-road.html#store-snapshots-of-video-stream-on-local-computer"><i class="fa fa-check"></i><b>6.5</b> Store snapshots of video stream on local computer</a><ul>
<li class="chapter" data-level="6.5.1" data-path="get-on-the-road.html"><a href="get-on-the-road.html#jie-hous-alternative"><i class="fa fa-check"></i><b>6.5.1</b> Jie Hou’s alternative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="donkeyCar.html"><a href="donkeyCar.html"><i class="fa fa-check"></i><b>7</b> Change to donkeycar</a><ul>
<li class="chapter" data-level="7.1" data-path="donkeyCar.html"><a href="donkeyCar.html#reason-for-changing-the-plattform"><i class="fa fa-check"></i><b>7.1</b> Reason for changing the plattform</a></li>
<li class="chapter" data-level="7.2" data-path="donkeyCar.html"><a href="donkeyCar.html#what-to-do"><i class="fa fa-check"></i><b>7.2</b> What to do</a></li>
<li class="chapter" data-level="7.3" data-path="donkeyCar.html"><a href="donkeyCar.html#rewiring-the-car"><i class="fa fa-check"></i><b>7.3</b> Rewiring the car</a><ul>
<li class="chapter" data-level="7.3.1" data-path="donkeyCar.html"><a href="donkeyCar.html#parts-list"><i class="fa fa-check"></i><b>7.3.1</b> Parts list</a></li>
<li class="chapter" data-level="7.3.2" data-path="donkeyCar.html"><a href="donkeyCar.html#why-not-using-pca9685"><i class="fa fa-check"></i><b>7.3.2</b> Why not using PCA9685</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="donkeyCar.html"><a href="donkeyCar.html#folders-created-during-installation-of-host-pc"><i class="fa fa-check"></i><b>7.4</b> Folders created during installation of host PC</a></li>
<li class="chapter" data-level="7.5" data-path="donkeyCar.html"><a href="donkeyCar.html#calibrate-the-car"><i class="fa fa-check"></i><b>7.5</b> Calibrate the car</a><ul>
<li class="chapter" data-level="7.5.1" data-path="donkeyCar.html"><a href="donkeyCar.html#throttle-calibration"><i class="fa fa-check"></i><b>7.5.1</b> Throttle Calibration</a></li>
<li class="chapter" data-level="7.5.2" data-path="donkeyCar.html"><a href="donkeyCar.html#configpyAfterCalib"><i class="fa fa-check"></i><b>7.5.2</b> Config.py after calibration</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="donkeyCar.html"><a href="donkeyCar.html#drive-your-car-with-web-interface"><i class="fa fa-check"></i><b>7.6</b> Drive your car with web interface</a><ul>
<li class="chapter" data-level="7.6.1" data-path="donkeyCar.html"><a href="donkeyCar.html#preparation-on-mac"><i class="fa fa-check"></i><b>7.6.1</b> Preparation on Mac</a></li>
<li class="chapter" data-level="7.6.2" data-path="donkeyCar.html"><a href="donkeyCar.html#preparation-on-raspberry"><i class="fa fa-check"></i><b>7.6.2</b> Preparation on Raspberry</a></li>
<li class="chapter" data-level="7.6.3" data-path="donkeyCar.html"><a href="donkeyCar.html#open-control-in-web-browser-on-mac"><i class="fa fa-check"></i><b>7.6.3</b> Open control in web browser on Mac</a></li>
<li class="chapter" data-level="7.6.4" data-path="donkeyCar.html"><a href="donkeyCar.html#setting-wifi-up-for-the-raspberry"><i class="fa fa-check"></i><b>7.6.4</b> Setting WIFI up for the raspberry</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="donkeyCar.html"><a href="donkeyCar.html#connecting-bluetooth-controller"><i class="fa fa-check"></i><b>7.7</b> Connecting bluetooth controller</a><ul>
<li class="chapter" data-level="7.7.1" data-path="donkeyCar.html"><a href="donkeyCar.html#BluetoothControllerInstall"><i class="fa fa-check"></i><b>7.7.1</b> Connect your bluetooth controller to the raspberry pi.</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="donkeyCar.html"><a href="donkeyCar.html#start-driving-or-training"><i class="fa fa-check"></i><b>7.8</b> Start driving or training</a><ul>
<li class="chapter" data-level="7.8.1" data-path="donkeyCar.html"><a href="donkeyCar.html#how-to-tether-raspberry-pi-to-android-device-hotspot"><i class="fa fa-check"></i><b>7.8.1</b> HOW TO TETHER RASPBERRY PI TO ANDROID DEVICE HOTSPOT</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="donkeyCar.html"><a href="donkeyCar.html#mange-recorded-data"><i class="fa fa-check"></i><b>7.9</b> Mange recorded data</a><ul>
<li class="chapter" data-level="7.9.1" data-path="donkeyCar.html"><a href="donkeyCar.html#archiving-data"><i class="fa fa-check"></i><b>7.9.1</b> Archiving data</a></li>
<li class="chapter" data-level="7.9.2" data-path="donkeyCar.html"><a href="donkeyCar.html#delete-data"><i class="fa fa-check"></i><b>7.9.2</b> Delete data</a></li>
<li class="chapter" data-level="7.9.3" data-path="donkeyCar.html"><a href="donkeyCar.html#copy-files-from-raspi-to-mac"><i class="fa fa-check"></i><b>7.9.3</b> Copy files from raspi to mac</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="donkeycar-software-analysis.html"><a href="donkeycar-software-analysis.html"><i class="fa fa-check"></i><b>8</b> Donkeycar software analysis</a><ul>
<li class="chapter" data-level="8.1" data-path="donkeycar-software-analysis.html"><a href="donkeycar-software-analysis.html#how-to-add-parts-to-a-vehicle"><i class="fa fa-check"></i><b>8.1</b> How to add parts to a vehicle</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="map-the-button-codes-to-the-button-names.html"><a href="map-the-button-codes-to-the-button-names.html"><i class="fa fa-check"></i><b>9</b> Map the button codes to the button names</a></li>
<li class="chapter" data-level="10" data-path="useful-links.html"><a href="useful-links.html"><i class="fa fa-check"></i><b>10</b> Useful links</a><ul>
<li class="chapter" data-level="10.1" data-path="useful-links.html"><a href="useful-links.html#donkey-car-1"><i class="fa fa-check"></i><b>10.1</b> Donkey car</a><ul>
<li class="chapter" data-level="10.1.1" data-path="useful-links.html"><a href="useful-links.html#videos-for-donkey-car"><i class="fa fa-check"></i><b>10.1.1</b> Videos for donkey car</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="useful-links.html"><a href="useful-links.html#parts"><i class="fa fa-check"></i><b>10.2</b> Parts</a></li>
<li class="chapter" data-level="10.3" data-path="useful-links.html"><a href="useful-links.html#little-setup-helpers"><i class="fa fa-check"></i><b>10.3</b> Little setup helpers</a></li>
<li class="chapter" data-level="10.4" data-path="useful-links.html"><a href="useful-links.html#meetup-in-stuttgart-area"><i class="fa fa-check"></i><b>10.4</b> Meetup in Stuttgart area</a></li>
<li class="chapter" data-level="10.5" data-path="useful-links.html"><a href="useful-links.html#other-stuff"><i class="fa fa-check"></i><b>10.5</b> Other stuff</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/RoboCarEsslingen" target="blank">Related files on Github</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">RoboCar project documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="donkeycar-software-analysis" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Donkeycar software analysis</h1>
<p>In this section the software of the donkeycar project is analysed with emphasis of how to use the software to gather training data and to modify the Keras model</p>
<div id="how-to-add-parts-to-a-vehicle" class="section level2">
<h2><span class="header-section-number">8.1</span> How to add parts to a vehicle</h2>
<p>Two brilliant videos by Tawn Kramer describe the Donkeycar framework. The <a href="https://www.youtube.com/watch?v=YZ4ESrtfShs">first part</a> describes in detail how to add a part to the vehicle. In short, a part will be added to the vehicle class and for each iteration of the loop the <strong>run</strong> or the <strong>run_threaded</strong> method of the added class will be executed.</p>
<p>The stacking of the methods are shown in figure <a href="donkeycar-software-analysis.html#fig:vehicleCalls">8.1</a></p>
<div class="figure"><span id="fig:vehicleCalls"></span>
<img src="images/DonkeyCarVehicleClass.png" alt="Stacking of methods" width="670" />
<p class="caption">
Figure 8.1: Stacking of methods
</p>
</div>
<pre><code>## function (data, expr, ...) 
## UseMethod(&quot;with&quot;)
## &lt;bytecode: 0x7fbe1b55c290&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p>from donkeycar.vehicle import Vehicle</p>
<pre><code>the Vehicle class is available and is instantiated by</code></pre>
<p>V = Vehicle()</p>
<pre><code>### Function V.start() 

To start vehicle&#39;s main drive loop. 
</code></pre>
<p>V.start()</p>
<pre><code>This is the main thread of the vehicle. It starts all the new threads for the threaded parts then starts an infinite loop that runs each part and updates the memory.

A Vehicle has

- memory
- parts
- threads
- Boolean flag &quot;ON&quot;

#### Parameters of V.start()
The parameters for ```V.start()``` are   

- rate_hz : int (default = 10Hz) 
    - The max frequency that the drive loop should run. The actual frequency may be less than this if there are many blocking parts.   

- max_loop_count : int  (default = None)
    - Maximum number of loops the drive loop should execute. This is used for testing the all the parts of the vehicle work.


#### Main run loop of V.start()
The main run loop of the V.start() function is below. The sleep_time assures that the loop rate is achieved. This can only be guaranteed if the update process duration of the parts does not exceed the loop time.
</code></pre>
<pre><code>       loop_count = 0
        while self.on:
            start_time = time.time()
            loop_count += 1

            self.update_parts()

            # stop drive loop if loop_count exceeds max_loopcount
            if max_loop_count and loop_count &gt; max_loop_count:
                self.on = False

            sleep_time = 1.0 / rate_hz - (time.time() - start_time)
            if sleep_time &gt; 0.0:
                time.sleep(sleep_time)</code></pre>
<pre><code>
### Function V.update_parts() 

In the ```V.update_parts()``` function the appropriate run function of part are being called.

#### Parameters of V.parts()
There are no parameters

#### Loop over all parts
The following code will be looped over for all parts
</code></pre>
<pre><code>    for entry in self.parts:
        # don&#39;t run if there is a run condition that is False
        run = True
        if entry.get(&#39;run_condition&#39;):
            run_condition = entry.get(&#39;run_condition&#39;)
            run = self.mem.get([run_condition])[0]
            # print(&#39;run_condition&#39;, entry[&#39;part&#39;], entry.get(&#39;run_condition&#39;), run)

        if run:
            p = entry[&#39;part&#39;]
            # get inputs from memory
            inputs = self.mem.get(entry[&#39;inputs&#39;])

            # run the part
            if entry.get(&#39;thread&#39;):
                outputs = p.run_threaded(*inputs)
            else:
                outputs = p.run(*inputs)

            # save the output to memory
            if outputs is not None:
                self.mem.put(entry[&#39;outputs&#39;], outputs)</code></pre>
<pre><code>It checks whether the part has inputs and passes the input to 

- ```p.run_threaded``` if the part is threaded
- ```p.run`` if the part is not threaded

If there are outputs the are passed to the output of the part using the name of the keys supplied by the call. The names of the inputs and outputs are defined when the parts are added via the ```V.add()```function

### Function V.add
Method to add a part to the vehicle drive loop. The names of parts in- and outputs are defined by the parameters of the ```V.add```function

#### Parameters of V.add()

- inputs : list
    - Channel names to get from memory.
- outputs : list
    - Channel names to save to memory.
- threaded : Boolean
    - If a part should be run in a separate thread.
- run_condition: Boolean
    - If a part should be run at all.

#### Example to add Web controller
The web controller is first instantiated and then added using the ```V.add()```function. The names of in- and outputs are supplied as well as the indicator that the controller is threaded. More on threaded parts in section \@ref(threadedParts)
</code></pre>
<p>ctr = LocalWebController(use_chaos=use_chaos) V.add(ctr, inputs=[‘cam/image_array’], outputs=[‘user/angle’, ‘user/throttle’, ‘user/mode’, ‘recording’], threaded=True)</p>
<pre><code>

### Concept of threads vs non-threaded parts {#threadedParts}

Updating of the parts is run in the loop of the ```V.update()```. To avoid that parts which take long to update blocks the loop they can be assigned to a dedicated thread. Whenever the a threaded part is updated the ```run_threaded```method is run. For a camera the  ```run_threaded``` is
</code></pre>
<p>def run_threaded(self): return self.frame</p>
<pre><code>which returns the frame available at the time, no delay being imposed on the loop.


#### The ```update``` function
Images are taken constantly as fast as possible by the method ```update``` as shown below
</code></pre>
<p>def update(self): # keep looping infinitely until the thread is stopped for f in self.stream: # grab the frame from the stream and clear the stream in # preparation for the next frame self.frame = f.array self.rawCapture.truncate(0)</p>
<pre><code>    # if the thread indicator variable is set, stop the thread
    if not self.on:
        break</code></pre>
<pre><code>#### The ```shutdown```function

To stop the thread a ```shutdown```function needs to be defined</code></pre>
<p>def shutdown(self): # indicate that the thread should be stopped self.on = False print(‘stoping PiCamera’) time.sleep(.5) self.stream.close() self.rawCapture.close() self.camera.close()</p>
<pre><code>
## Locate modules on raspi which are being imported by manage.py

Where on the Raspberry Pi are the modules located which are being imported by the python script ```manage.py```
</code></pre>
<p>from docopt import docopt</p>
<p>import donkeycar as dk from donkeycar.parts.camera import PiCamera from donkeycar.parts.transform import Lambda from donkeycar.parts.keras import KerasLinear from donkeycar.parts.actuator import PCA9685, PWMSteering, PWMThrottle from donkeycar.parts.datastore import TubGroup, TubWriter from donkeycar.parts.web_controller import LocalWebController from donkeycar.parts.clock import Timestamp from donkeypart_bluetooth_game_controller import BluetoothGameController</p>
<pre><code>
donkeycar is found at the raspi
</code></pre>
<p>(env) <a href="mailto:pi@donkeypi_uwe">pi@donkeypi_uwe</a>:~ $ find . -name donkeycar ./env/lib/python3.5/site-packages/donkeycar</p>
<pre><code>listing this folder</code></pre>
<p>(env) <a href="mailto:pi@donkeypi_uwe">pi@donkeypi_uwe</a>:~ $ cd ./env/lib/python3.5/site-packages/donkeycar (env) <a href="mailto:pi@donkeypi_uwe">pi@donkeypi_uwe</a>:~/env/lib/python3.5/site-packages/donkeycar $ ls config.py <strong>init</strong>.py log.py management memory.py parts <strong>pycache</strong> templates tests util vehicle.py</p>
<pre><code>which are the same files and folders which are located at the [official GitHub page of DonkeyCar project](https://github.com/autorope/donkeycar/tree/dev/donkeycar)

The donkeypart_bluetooth_game_controller was installed during the set up of the raspi for the project as described in section \@ref(BluetoothControllerInstall)

## Assignment of WiiU controller sticks to action

The mapping from button codes to button names is defined in ```donkeypart_bluetooth_game_controller/wiiu_config.yml```
</code></pre>
<p>device_search_term: ‘nintendo’</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="donkeyCar.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="map-the-button-codes-to-the-button-names.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["RoboCarDokumentation.pdf", "RoboCarDokumentation.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
